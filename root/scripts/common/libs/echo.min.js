!function(t,e){"function"==typeof define&&define.amd?define(function(){return e(t)}):"object"==typeof exports?module.exports=e:t.echo=e(t)}(this,function(u){"use strict";var d,t,c,a,l,i={},f=function(){},s=function(t,e){if(null===t.offsetParent)return!1;var n=t.getBoundingClientRect();return n.right>=e.l&&n.bottom>=e.t&&n.left<=e.r&&n.top<=e.b},h=function(){(a||!t)&&(clearTimeout(t),t=setTimeout(function(){i.render(),t=null},c))};return i.init=function(t){var e=(t=t||{}).offset||0,n=t.offsetVertical||e,o=t.offsetHorizontal||e,r=function(t,e){return parseInt(t||e,10)};d={t:r(t.offsetTop,n),b:r(t.offsetBottom,n),l:r(t.offsetLeft,o),r:r(t.offsetRight,o)},c=r(t.throttle,250),a=!1!==t.debounce,l=!!t.unload,f=t.callback||f,i.render(),document.addEventListener?(u.addEventListener("scroll",h,!1),u.addEventListener("load",h,!1)):(u.attachEvent("onscroll",h),u.attachEvent("onload",h))},i.render=function(t){for(var e,n,o=(t||document).querySelectorAll("[data-echo], [data-echo-background]"),r=o.length,c={l:0-d.l,t:0-d.t,b:(u.innerHeight||document.documentElement.clientHeight)+d.b,r:(u.innerWidth||document.documentElement.clientWidth)+d.r},a=0;a<r;a++)n=o[a],s(n,c)?(l&&n.setAttribute("data-echo-placeholder",n.src),null!==n.getAttribute("data-echo-background")?n.style.backgroundImage="url("+n.getAttribute("data-echo-background")+")":n.src!==(e=n.getAttribute("data-echo"))&&(n.src=e),l||(n.removeAttribute("data-echo"),n.removeAttribute("data-echo-background")),f(n,"load")):l&&(e=n.getAttribute("data-echo-placeholder"))&&(null!==n.getAttribute("data-echo-background")?n.style.backgroundImage="url("+e+")":n.src=e,n.removeAttribute("data-echo-placeholder"),f(n,"unload"));r||i.detach()},i.detach=function(){document.removeEventListener?u.removeEventListener("scroll",h):u.detachEvent("onscroll",h),clearTimeout(t)},i});